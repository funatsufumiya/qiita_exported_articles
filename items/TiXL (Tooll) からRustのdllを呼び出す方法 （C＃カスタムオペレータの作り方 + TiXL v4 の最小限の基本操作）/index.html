<h1>TiXL (Tooll) からRustのdllを呼び出す方法 （C＃カスタムオペレータの作り方 + TiXL v4 の最小限の基本操作）</h1>
<div data-sourcepos="1:1-5:3" class="note warn">
<span class="fa fa-fw fa-exclamation-circle"></span><div>
<p data-sourcepos="2:1-2:111">この記事は、執筆時点でまだプレビュー版のTiXL (v4)を取り扱った記事になります。</p>
<p data-sourcepos="4:1-4:228">今後の安定版では仕様などが変更される可能性がありますので、あくまで参考程度にし、都度公式ドキュメントやソースコードをよく確認されることをおすすめします。</p>
</div>
</div>
<div data-sourcepos="8:1-10:3" class="note info">
<span class="fa fa-fw fa-check-circle"></span><div>
<p data-sourcepos="9:1-9:285">【追記】2025/07/26にTiXL v4がついに<a href="https://github.com/tixl3d/tixl/releases" rel="nofollow noopener" target="_blank">正式リリース</a>になったので、下記内容も再検証を行い、インストールパスの修正や、注意点などを追記しています。流れ自体に変更はありません。</p>
</div>
</div>
<h2 data-sourcepos="12:1-12:28">
<span id="まずtixl-tooll-とは" class="fragment"></span><a href="#%E3%81%BE%E3%81%9Atixl-tooll-%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>まずTiXL (Tooll) とは</h2>
<p data-sourcepos="14:1-14:265"><a href="https://www.tixl.app/" rel="nofollow noopener" target="_blank">TiXL</a>というVJツールキットがある。バージョン3まではToollと呼ばれていて、執筆時点で<a href="https://github.com/tixl3d/tixl/releases" rel="nofollow noopener" target="_blank">プレビュー版のバージョン4</a>からTiXLと呼ばれるようになった。</p>
<p data-sourcepos="16:1-16:179"><a href="https://www.tixl.app/" rel="nofollow noopener" target="_blank"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F44103%2F45d555f0-bea9-4fb2-b931-4e0a08f6e566.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=f7c836a97a748f98070a0dae006cecae" alt="SnapCrab_NoName_2025-5-20_9-58-31_No-00.png""https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/44103/45d555f0-bea9-4fb2-b931-4e0a08f6e566.png" loading="lazy"></a></p>
<p data-sourcepos="18:1-18:160">TiXL (Tooll) の特徴として、<a href="https://derivative.ca/" rel="nofollow noopener" target="_blank">TouchDesigner</a>のようなノードベースのリアルタイムグラフィックスが扱える。</p>
<p data-sourcepos="20:1-20:155"><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F44103%2F51975b88-b1ef-4fe9-b1c4-2e7d93064beb.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=2892e1a4d9ad205777ba6e893c82b688" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F44103%2F51975b88-b1ef-4fe9-b1c4-2e7d93064beb.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=2892e1a4d9ad205777ba6e893c82b688" alt="SnapCrab_NoName_2025-5-19_17-52-30_No-00.png""https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/44103/51975b88-b1ef-4fe9-b1c4-2e7d93064beb.png" loading="lazy"></a></p>
<p data-sourcepos="22:1-22:399">内部構造的にはどちらかといえばUnityの<a href="https://unity.com/ja/features/visual-effect-graph" rel="nofollow noopener" target="_blank">VFX Graph</a>に近くて、コンピュートシェーダーを基本としたGPU駆動のグラフィックス操作に特徴がある。特にv4 (TiXL) からはSDF (Signed Distance Field) 周りのオペレータなどが拡充されたり、操作性や全体構造などが改善された。</p>
<p data-sourcepos="24:1-24:147"><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F44103%2Faff34ac0-db12-4195-801f-c5c4bb85399e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=9c469f15839ea8544ffc9df4caac02ad" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F44103%2Faff34ac0-db12-4195-801f-c5c4bb85399e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=9c469f15839ea8544ffc9df4caac02ad" alt="スクリーンショット (15).png""https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/44103/aff34ac0-db12-4195-801f-c5c4bb85399e.png" loading="lazy"></a></p>
<h2 data-sourcepos="26:1-26:21">
<span id="本記事の概要" class="fragment"></span><a href="#%E6%9C%AC%E8%A8%98%E4%BA%8B%E3%81%AE%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>本記事の概要</h2>
<p data-sourcepos="28:1-28:146"><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F44103%2Ff206e7a2-633c-4a63-9bb0-d969a3ff1102.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=8081ec066359b0c80bef35c20003e700" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F44103%2Ff206e7a2-633c-4a63-9bb0-d969a3ff1102.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=8081ec066359b0c80bef35c20003e700" alt="スクリーンショット (5).png""https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/44103/f206e7a2-633c-4a63-9bb0-d969a3ff1102.png" loading="lazy"></a></p>
<p data-sourcepos="30:1-30:194">本記事では、プレビュー版のTiXL v4（執筆時点でv4.0.2 Preview 3）において、Rustのdllを自作のC#オペレータ（ノード）から呼び出す方法を紹介する。</p>
<div data-sourcepos="32:1-34:3" class="note warn">
<span class="fa fa-fw fa-exclamation-circle"></span><div>
<p data-sourcepos="33:1-33:251">TiXL (v4) も基本的にはTooll3と同じなので、極力両方のバージョンを意識しながら解説していくものの、<strong>今後のバージョンアップ等によってフォルダ構造の変更の可能性がある点に注意</strong>。</p>
</div>
</div>
<h2 data-sourcepos="36:1-36:58">
<span id="tixl-v4-で最初のプロジェクトを作る方法" class="fragment"></span><a href="#tixl-v4-%E3%81%A7%E6%9C%80%E5%88%9D%E3%81%AE%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E4%BD%9C%E3%82%8B%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>TiXL (v4) で最初のプロジェクトを作る方法</h2>
<p data-sourcepos="38:1-38:189">執筆時点で TiXL (v4) の情報が皆無なので、最初の基本操作だけ紹介しておきたい。（<strong>Tooll3の場合は全く手順が違うので飛ばしてほしい。</strong>）</p>
<p data-sourcepos="40:1-40:180">TiXL (v4) を起動すると、Project Hubというものが最初に起動する。その横にある「＋」(プラスマーク) から、新たにプロジェクトを作る。</p>
<p data-sourcepos="42:1-42:160"><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F44103%2F1abe31cd-322a-4ddf-be5a-f6508c8e8d21.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=8fe2f46eedd6078519fbf0967fc98a6f" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F44103%2F1abe31cd-322a-4ddf-be5a-f6508c8e8d21.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=8fe2f46eedd6078519fbf0967fc98a6f" alt="スクリーンショット 2025-05-20 122304.png""https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/44103/1abe31cd-322a-4ddf-be5a-f6508c8e8d21.png" loading="lazy"></a></p>
<p data-sourcepos="44:1-44:121">Project Hubから出来上がったプロジェクトを開くと、Exampleなどの雛形が生成されている。<sup><a href="#fn-1" id="fnref-1">1</a></sup></p>
<p data-sourcepos="46:1-46:160"><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F44103%2F60196bcd-23b4-45b6-819e-c031e10f3a53.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=fc14098d47c4d203f66b4afce651cf5a" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F44103%2F60196bcd-23b4-45b6-819e-c031e10f3a53.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=fc14098d47c4d203f66b4afce651cf5a" alt="スクリーンショット 2025-05-20 122448.png""https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/44103/60196bcd-23b4-45b6-819e-c031e10f3a53.png" loading="lazy"></a></p>
<p data-sourcepos="48:1-48:103">ここで、「TiXL &gt; New Operator...」を使って新しいシーン（オペレータ）を作る。</p>
<p data-sourcepos="50:1-50:146"><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F44103%2F442fa962-b7b2-424d-9b88-5b8004dac62c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=6518ebeec15d8f79e8f0ac8f3cd527fa" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F44103%2F442fa962-b7b2-424d-9b88-5b8004dac62c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=6518ebeec15d8f79e8f0ac8f3cd527fa" alt="スクリーンショット (6).png""https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/44103/442fa962-b7b2-424d-9b88-5b8004dac62c.png" loading="lazy"></a></p>
<p data-sourcepos="52:1-52:160"><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F44103%2Fb26bc6a7-9dec-4ff8-a8bb-afec93a5686e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=671d81962cbf77b53ce2e70a2d3b594a" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F44103%2Fb26bc6a7-9dec-4ff8-a8bb-afec93a5686e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=671d81962cbf77b53ce2e70a2d3b594a" alt="スクリーンショット 2025-05-20 122549.png""https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/44103/b26bc6a7-9dec-4ff8-a8bb-afec93a5686e.png" loading="lazy"></a></p>
<p data-sourcepos="54:1-54:139">作られたオペレータは先程のExampleの雛形に混じって置かれているので、ダブルクリックすると開ける。</p>
<p data-sourcepos="56:1-56:146"><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F44103%2F3a794dec-d3c8-47aa-8757-09281e23e1c3.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=0c3c04575b731e990ffdd1be2d90ed45" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F44103%2F3a794dec-d3c8-47aa-8757-09281e23e1c3.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=0c3c04575b731e990ffdd1be2d90ed45" alt="スクリーンショット (7).png""https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/44103/3a794dec-d3c8-47aa-8757-09281e23e1c3.png" loading="lazy"></a></p>
<p data-sourcepos="58:1-58:146"><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F44103%2Fd553b4eb-ac9f-4dd0-a433-8de627cd918a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=4b44f29b19a74d63ba4bea79bd406ed6" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F44103%2Fd553b4eb-ac9f-4dd0-a433-8de627cd918a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=4b44f29b19a74d63ba4bea79bd406ed6" alt="スクリーンショット (8).png""https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/44103/d553b4eb-ac9f-4dd0-a433-8de627cd918a.png" loading="lazy"></a></p>
<p data-sourcepos="60:1-60:308">あとの基本操作はTooll3と変わらないが、MagGraphと呼ばれる、磁石のマグネットのようにノードがくっつく新しい操作スタイルなどの若干の変更点はある（無効化もできる）。これについては当記事の範疇を超えるので、割愛する。</p>
<p data-sourcepos="62:1-62:220">（新規ノードを作るときはTabキー、削除するときはバックスペースを2回押し、上の階層に戻るときは背景をダブルクリック、くらい覚えておけば大丈夫なはず。）</p>
<h2 data-sourcepos="64:1-64:68">
<span id="tixl-tooll3-でカスタムオペレータ-c-を作る方法" class="fragment"></span><a href="#tixl-tooll3-%E3%81%A7%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%82%AA%E3%83%9A%E3%83%AC%E3%83%BC%E3%82%BF-c-%E3%82%92%E4%BD%9C%E3%82%8B%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>TiXL (Tooll3) でカスタムオペレータ (C#) を作る方法</h2>
<p data-sourcepos="66:1-66:48">これについては以下動画が詳しい。</p>
<iframe width="100%" height="315" src="https://www.youtube.com/embed/fMxJLrElHaA?si=1zi3pYZ_u1r7AvfC" frameborder="0" allowfullscreen></iframe>
<p data-sourcepos="71:1-71:234">TiXL (Tooll) では、ノード（オペレータ）を右クリックすると「Symbol definition... &gt; Duplicate as new type...」という、既存のノードを複製して独自のカスタムノードを作る機能がある。</p>
<p data-sourcepos="73:1-73:146"><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F44103%2Fdc0c6024-5a77-4830-81f0-03395a03fcd4.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=5a0fcc68f915d73d58316b82b45cda14" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F44103%2Fdc0c6024-5a77-4830-81f0-03395a03fcd4.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=5a0fcc68f915d73d58316b82b45cda14" alt="スクリーンショット (9).png""https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/44103/dc0c6024-5a77-4830-81f0-03395a03fcd4.png" loading="lazy"></a></p>
<p data-sourcepos="75:1-75:471">ここで一点注意として、どんなオペレータでも複製できるのだけれど、ノードベースなのですべてのオペレータがC#で作られているとは限らない。どのオペレータもインターフェイスとしてのC#は必ず生成されるが、中身がほとんどないものはノードベースで構築されていて、C#以外のメタファイル（<code>.t3</code>や<code>.t3ui</code>）などに結線の情報が記述されている。</p>
<h2 data-sourcepos="77:1-77:60">
<span id="moduloを複製してカスタムオペレータを作る" class="fragment"></span><a href="#modulo%E3%82%92%E8%A4%87%E8%A3%BD%E3%81%97%E3%81%A6%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%82%AA%E3%83%9A%E3%83%AC%E3%83%BC%E3%82%BF%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>Moduloを複製してカスタムオペレータを作る</h2>
<p data-sourcepos="79:1-79:117">まずここでは、「Modulo」というオペレータを複製する。名前はRustInteropTestとしておく。</p>
<p data-sourcepos="81:1-81:146"><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F44103%2Fdc0c6024-5a77-4830-81f0-03395a03fcd4.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=5a0fcc68f915d73d58316b82b45cda14" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F44103%2Fdc0c6024-5a77-4830-81f0-03395a03fcd4.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=5a0fcc68f915d73d58316b82b45cda14" alt="スクリーンショット (9).png""https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/44103/dc0c6024-5a77-4830-81f0-03395a03fcd4.png" loading="lazy"></a></p>
<p data-sourcepos="83:1-83:160"><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F44103%2Fbab4a622-e845-4c6d-b7ea-132c7ca6d102.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=9c008346b530ce2d889e474e0274e89c" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F44103%2Fbab4a622-e845-4c6d-b7ea-132c7ca6d102.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=9c008346b530ce2d889e474e0274e89c" alt="スクリーンショット 2025-05-20 104635.png""https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/44103/bab4a622-e845-4c6d-b7ea-132c7ca6d102.png" loading="lazy"></a></p>
<p data-sourcepos="85:1-85:203">複製元のModuloの元コードは以下のようになる。（複製によって<code>namespace</code>とクラス名は変更される。） <strong>※ コードの開き方はすぐ後の項で後述します。</strong></p>
<p data-sourcepos="87:1-87:120"><iframe id="qiita-embed-content__7c802dffeecd041097339da9b38c1934" src="https://qiita.com/embed-contents/link-card#qiita-embed-content__7c802dffeecd041097339da9b38c1934" data-content="https%3A%2F%2Fgithub.com%2Ftixl3d%2Ftixl%2Fblob%2F813a220493bacc5469a581891feb3c5a04473ccc%2FOperators%2FLib%2Fnumbers%2Ffloat%2Fbasic%2FModulo.cs" frameborder="0" scrolling="no" loading="lazy" style="width:100%;" height="29">
</iframe>
</p>
<p data-sourcepos="89:1-89:48">以下に念の為全文を掲載しておく。</p>
<div class="code-frame" data-lang="cs" data-sourcepos="91:1-127:3">
<div class="code-lang"><span class="bold">Modulo.cs</span></div>
<div class="highlight"><pre><code><span class="k">namespace</span> <span class="nn">Lib.numbers.@float.basic</span><span class="p">;</span>

<span class="p">[</span><span class="nf">Guid</span><span class="p">(</span><span class="s">"5202d3f6-c970-4006-933d-3c60d6c202dc"</span><span class="p">)]</span>
<span class="k">internal</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">Modulo</span> <span class="p">:</span> <span class="n">Instance</span><span class="p">&lt;</span><span class="n">Modulo</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">Output</span><span class="p">(</span><span class="n">Guid</span> <span class="p">=</span> <span class="s">"4e4ebbcf-6b12-4ce7-9bec-78cd9049e239"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="n">Slot</span><span class="p">&lt;</span><span class="kt">float</span><span class="p">&gt;</span> <span class="n">Result</span> <span class="p">=</span> <span class="k">new</span><span class="p">();</span>

    <span class="k">public</span> <span class="nf">Modulo</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Result</span><span class="p">.</span><span class="n">UpdateAction</span> <span class="p">+=</span> <span class="n">Update</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">Update</span><span class="p">(</span><span class="n">EvaluationContext</span> <span class="n">context</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">v</span> <span class="p">=</span> <span class="n">Value</span><span class="p">.</span><span class="nf">GetValue</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
        <span class="kt">var</span> <span class="n">mod2</span> <span class="p">=</span> <span class="n">ModuloValue</span><span class="p">.</span><span class="nf">GetValue</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">mod2</span> <span class="p">!=</span> <span class="m">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Result</span><span class="p">.</span><span class="n">Value</span> <span class="p">=</span> <span class="n">v</span> <span class="p">-</span> <span class="n">mod2</span> <span class="p">*</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">Math</span><span class="p">.</span><span class="nf">Floor</span><span class="p">(</span><span class="n">v</span><span class="p">/</span><span class="n">mod2</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="n">T3</span><span class="p">.</span><span class="n">Core</span><span class="p">.</span><span class="n">Logging</span><span class="p">.</span><span class="n">Log</span><span class="p">.</span><span class="nf">Debug</span><span class="p">(</span><span class="s">"Modulo caused division by zero"</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
            <span class="n">Result</span><span class="p">.</span><span class="n">Value</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
        
    <span class="p">[</span><span class="nf">Input</span><span class="p">(</span><span class="n">Guid</span> <span class="p">=</span> <span class="s">"8a401e5d-295d-4403-a3af-1d6b91ce3dba"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="n">InputSlot</span><span class="p">&lt;</span><span class="kt">float</span><span class="p">&gt;</span> <span class="n">Value</span> <span class="p">=</span> <span class="k">new</span><span class="p">();</span>

    <span class="p">[</span><span class="nf">Input</span><span class="p">(</span><span class="n">Guid</span> <span class="p">=</span> <span class="s">"62a8185f-32c0-41d2-b8be-d8c1d7178c00"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="n">InputSlot</span><span class="p">&lt;</span><span class="kt">float</span><span class="p">&gt;</span> <span class="n">ModuloValue</span> <span class="p">=</span> <span class="k">new</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
</div>
<p data-sourcepos="129:1-129:366">ここで注意として、各Guidは一意になっていないといけない<sup><a href="#fn-2" id="fnref-2">2</a></sup>。Powershellの<code>New-Guid</code>コマンドからもGuidの新規生成は可能で、自分の場合はVSCodeのGuid生成の拡張機能を使っている。（ショートカットキーなど好みがあると思うし、複数種あるので好きなものを選んでほしい。）</p>
<p data-sourcepos="131:1-131:322">ここで生成したGuidは、先ほどちらっと触れた、<code>.t3</code> や <code>.t3ui</code> などのメタデータの中で利用される。本来はそちらの記述も変更したり、エディタから生成されるものからコピーしたりする必要があるが、これについては当記事では割愛する。</p>
<h2 data-sourcepos="133:1-133:32">
<span id="cのコードを開く方法" class="fragment"></span><a href="#c%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E9%96%8B%E3%81%8F%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>C#のコードを開く方法</h2>
<p data-sourcepos="135:1-135:317">順番が少し前後して申し訳ないが、オペレータを複製して<strong>一度プロジェクトを保存する</strong>と、プロジェクトフォルダに <code>.cs</code> が生成される。（<strong>→ 一度プロジェクトを保存するのが必要。</strong> 保存していないとファイルも生成されない。）</p>
<p data-sourcepos="137:1-137:151">これを開くには、素朴に<code>.cs</code>をVSCodeなどから開いて編集しても良い。この場合も<code>.cs</code>は自動的に再ビルドされる。</p>
<p data-sourcepos="139:1-139:320">ただそれだと構文解析などがあまり効かなくて不便なので、TiXL (v4) の場合は、一度プロジェクトを一つ開いたあと、「TiXL &gt; Open Project in... &gt; Development IDE」からVisual Studioのプロジェクトを開くと良い。<sup><a href="#fn-b" id="fnref-b">3</a></sup> （※ Tooll 3 の場合は、脚注参照。）</p>
<p data-sourcepos="141:1-141:160"><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F44103%2Fdd5f205e-104d-4645-b3c1-a5e5f1023745.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=10e8ba0cbb77b37814cd0198779431d1" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F44103%2Fdd5f205e-104d-4645-b3c1-a5e5f1023745.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=10e8ba0cbb77b37814cd0198779431d1" alt="スクリーンショット 2025-05-20 105819.png""https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/44103/dd5f205e-104d-4645-b3c1-a5e5f1023745.png" loading="lazy"></a></p>
<p data-sourcepos="143:1-143:160"><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F44103%2F27544299-a14a-4884-8a67-323c0cb84e89.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=9ac2e3bb1aeb3513d51cb2a45f7d699b" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F44103%2F27544299-a14a-4884-8a67-323c0cb84e89.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=9ac2e3bb1aeb3513d51cb2a45f7d699b" alt="スクリーンショット 2025-05-20 114904.png""https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/44103/27544299-a14a-4884-8a67-323c0cb84e89.png" loading="lazy"></a></p>
<p data-sourcepos="145:1-145:568">注意として、Visual Studioで開く場合も、ビルドはファイルの変更を検知して基本的に自動で行われるので、Visual Studio側から再ビルドを行う必要はない。ただ、稀にTiXL自体が起動しなくなるようなdllを生成してしまうことがあるので、その場合はプロジェクトフォルダの<code>bin\Debug</code> 以下を一度削除して再起動する必要が出てくる。（ブラウザでいうところのキャッシュを消すような感じ。）<sup><a href="#fn-c" id="fnref-c">4</a></sup> (※ Tooll 3 の場合は、脚注参照。)</p>
<h2 data-sourcepos="147:1-147:54">
<span id="tixl-v4-と-tooll3-のフォルダ構造の違い" class="fragment"></span><a href="#tixl-v4-%E3%81%A8-tooll3-%E3%81%AE%E3%83%95%E3%82%A9%E3%83%AB%E3%83%80%E6%A7%8B%E9%80%A0%E3%81%AE%E9%81%95%E3%81%84"><i class="fa fa-link"></i></a>TiXL (v4) と Tooll3 のフォルダ構造の違い</h2>
<p data-sourcepos="149:1-149:96">ここで一点、バージョンごとにフォルダ構造の違いに触れておきたい。</p>
<p data-sourcepos="151:1-151:284"><strong>Tooll3までは、すべてのプロジェクトが一箇所で一元管理されていた。</strong> インストールフォルダそのものがプロジェクトフォルダとなっているので、ある意味わかりやすいが、ファイルがごちゃごちゃしやすい。</p>
<p data-sourcepos="153:1-153:294">TiXL (v4) からは、ユーザのプロジェクトは基本的に <code>Documents\TiXL</code> 以下に配置されるようになった。<strong>インストールフォルダ</strong> (例えば <code>C:\TiXL\TiXL-v4.0.2</code>や<code>C:\Program Files\TiXL\TiXL 4.0.5.2</code>) <strong>とは分離されている</strong> ので注意が必要。</p>
<h2 data-sourcepos="155:1-155:48">
<span id="カスタムオペレータを作っていく" class="fragment"></span><a href="#%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%82%AA%E3%83%9A%E3%83%AC%E3%83%BC%E3%82%BF%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%84%E3%81%8F"><i class="fa fa-link"></i></a>カスタムオペレータを作っていく</h2>
<p data-sourcepos="157:1-157:171">さて、ここからは好きにコードをいじれば良いのだけれど、先に全文を掲載する。（namespaceなどは各人で読み替えてほしい。）</p>
<p data-sourcepos="159:1-159:267">※ 前述のように、Guidは一意になっていないといけないので、自分で自作するときは、PowershellのNew-GuidコマンドなどからGuidを適宜生成することを推奨。これを自動化するアドオン等については割愛。</p>
<div data-sourcepos="161:1-163:3" class="note warn">
<span class="fa fa-fw fa-exclamation-circle"></span><div>
<p data-sourcepos="162:1-162:363"><strong>【追記】4.0.5正式版で確認したところ、TiXLの起動中に編集してしまうと、.csファイルごと消えてしまう現象が確認されており、編集時はTiXLを閉じることを強く推奨。</strong> <sup><a href="#fn-a" id="fnref-a">5</a></sup> （※ 既に編集済みでこの現象によってファイルが消えてしまった場合は、脚注を参照のこと！）</p>
</div>
</div>
<div class="code-frame" data-lang="cs" data-sourcepos="165:1-212:3">
<div class="code-lang"><span class="bold">RustInteropTest.cs</span></div>
<div class="highlight"><pre><code><span class="k">using</span> <span class="nn">System.Runtime.InteropServices</span><span class="p">;</span>
<span class="k">namespace</span> <span class="nn">fu.test.test2</span><span class="p">;</span>


<span class="p">[</span><span class="nf">Guid</span><span class="p">(</span><span class="s">"4334b296-8559-4707-a35b-99ccb08215a7"</span><span class="p">)]</span>
<span class="k">internal</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">RustInteropTest</span> <span class="p">:</span> <span class="n">Instance</span><span class="p">&lt;</span><span class="n">RustInteropTest</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="s">"rust_interop_lib.dll"</span><span class="p">,</span> <span class="n">CallingConvention</span> <span class="p">=</span> <span class="n">CallingConvention</span><span class="p">.</span><span class="n">Cdecl</span><span class="p">)]</span>
    <span class="k">private</span> <span class="k">static</span> <span class="k">extern</span> <span class="kt">float</span> <span class="k">add</span><span class="p">(</span><span class="kt">float</span> <span class="n">a</span><span class="p">,</span> <span class="kt">float</span> <span class="n">b</span><span class="p">);</span>

    <span class="p">[</span><span class="nf">Output</span><span class="p">(</span><span class="n">Guid</span> <span class="p">=</span> <span class="s">"8fd92c8e-d043-4a6e-97b7-594830f59e2c"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="n">Slot</span><span class="p">&lt;</span><span class="kt">float</span><span class="p">&gt;</span> <span class="n">Result</span> <span class="p">=</span> <span class="k">new</span><span class="p">();</span>

    <span class="p">[</span><span class="nf">Output</span><span class="p">(</span><span class="n">Guid</span> <span class="p">=</span> <span class="s">"7b1b40b9-9450-43d0-a8e6-1d05ac5ff313"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="n">Slot</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">OutText</span> <span class="p">=</span> <span class="k">new</span><span class="p">();</span>

    <span class="k">public</span> <span class="nf">RustInteropTest</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">OutText</span><span class="p">.</span><span class="n">UpdateAction</span> <span class="p">+=</span> <span class="n">Update</span><span class="p">;</span>
        <span class="n">Result</span><span class="p">.</span><span class="n">UpdateAction</span> <span class="p">+=</span> <span class="n">Update</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">Update</span><span class="p">(</span><span class="n">EvaluationContext</span> <span class="n">context</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">a</span> <span class="p">=</span> <span class="n">ValueA</span><span class="p">.</span><span class="nf">GetValue</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
        <span class="kt">var</span> <span class="n">b</span> <span class="p">=</span> <span class="n">ValueB</span><span class="p">.</span><span class="nf">GetValue</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
        <span class="kt">var</span> <span class="n">v</span> <span class="p">=</span> <span class="m">0.0f</span><span class="p">;</span>

        <span class="k">try</span> <span class="p">{</span>
            <span class="n">v</span> <span class="p">=</span> <span class="k">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
            <span class="n">Result</span><span class="p">.</span><span class="n">Value</span> <span class="p">=</span> <span class="n">v</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">T3</span><span class="p">.</span><span class="n">Core</span><span class="p">.</span><span class="n">Logging</span><span class="p">.</span><span class="n">Log</span><span class="p">.</span><span class="nf">Debug</span><span class="p">(</span><span class="s">"RustInteropTest caused exception (maybe dll not found): {0}"</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>
            <span class="n">Result</span><span class="p">.</span><span class="n">Value</span> <span class="p">=</span> <span class="m">0.0f</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">OutText</span><span class="p">.</span><span class="n">Value</span> <span class="p">=</span> <span class="s">$"</span><span class="p">{</span><span class="n">a</span><span class="p">}</span><span class="s"> + </span><span class="p">{</span><span class="n">b</span><span class="p">}</span><span class="s"> -&gt; </span><span class="p">{</span><span class="n">v</span><span class="p">}</span><span class="s">"</span><span class="p">;</span>
    <span class="p">}</span>
        
    <span class="p">[</span><span class="nf">Input</span><span class="p">(</span><span class="n">Guid</span> <span class="p">=</span> <span class="s">"61814eeb-54eb-4f0e-a896-1292698e3c4e"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="n">InputSlot</span><span class="p">&lt;</span><span class="kt">float</span><span class="p">&gt;</span> <span class="n">ValueA</span> <span class="p">=</span> <span class="k">new</span><span class="p">();</span>

    <span class="p">[</span><span class="nf">Input</span><span class="p">(</span><span class="n">Guid</span> <span class="p">=</span> <span class="s">"ca343900-a386-43b8-91b7-366cd9d72379"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="n">InputSlot</span><span class="p">&lt;</span><span class="kt">float</span><span class="p">&gt;</span> <span class="n">ValueB</span> <span class="p">=</span> <span class="k">new</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
</div>
<p data-sourcepos="214:1-214:163">このコードでは、出力が2つあって、<code>Result</code> (<code>float</code>) に 入力された <code>ValueA</code> (<code>float</code>) と <code>ValueB</code> (<code>float</code>) の足し算の結果を返す。</p>
<p data-sourcepos="216:1-216:203">そして、デバッグ用に <code>OutText</code> (<code>string</code>) に、 <code>a + b -&gt; c</code> のテキストを返す。（冒頭のスクリーンショット ↓ ではこちらを使って結果を表示している。）</p>
<p data-sourcepos="218:1-218:146"><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F44103%2Ff206e7a2-633c-4a63-9bb0-d969a3ff1102.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=8081ec066359b0c80bef35c20003e700" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F44103%2Ff206e7a2-633c-4a63-9bb0-d969a3ff1102.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=8081ec066359b0c80bef35c20003e700" alt="スクリーンショット (5).png""https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/44103/f206e7a2-633c-4a63-9bb0-d969a3ff1102.png" loading="lazy"></a></p>
<h2 data-sourcepos="220:1-220:31">
<span id="rust側のdllを準備する" class="fragment"></span><a href="#rust%E5%81%B4%E3%81%AEdll%E3%82%92%E6%BA%96%E5%82%99%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Rust側のdllを準備する</h2>
<p data-sourcepos="222:1-222:66">先程のコードのDLL呼び出し部分を見ておきたい。</p>
<div class="code-frame" data-lang="cs" data-sourcepos="224:1-227:3"><div class="highlight"><pre><code><span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="s">"rust_interop_lib.dll"</span><span class="p">,</span> <span class="n">CallingConvention</span> <span class="p">=</span> <span class="n">CallingConvention</span><span class="p">.</span><span class="n">Cdecl</span><span class="p">)]</span>
<span class="k">private</span> <span class="k">static</span> <span class="k">extern</span> <span class="kt">float</span> <span class="k">add</span><span class="p">(</span><span class="kt">float</span> <span class="n">a</span><span class="p">,</span> <span class="kt">float</span> <span class="n">b</span><span class="p">);</span>
</code></pre></div></div>
<p data-sourcepos="229:1-229:314">ごくシンプルに、<code>rust_interop_lib.dll</code> というものから、<code>float add(float a, float b)</code> に該当する関数を呼び出すというものになっている。（呼び出し時にdll関係のエラーが出る可能性があるので、try-catchで囲んで呼び出している点にも注意。）</p>
<p data-sourcepos="231:1-231:172">となるとあとは単純にこの名前のdllを作って、TiXL (Tooll) が実行時にdllを確認できるパスにそのdllを配置すれば良いことになる。</p>
<p data-sourcepos="233:1-233:30">雛形は以下に作った。</p>
<p data-sourcepos="235:1-235:49"><iframe id="qiita-embed-content__dc947b1851f5cf433527d7990bb25517" src="https://qiita.com/embed-contents/link-card#qiita-embed-content__dc947b1851f5cf433527d7990bb25517" data-content="https%3A%2F%2Fgithub.com%2Ffunatsufumiya%2Frust_interop_lib" frameborder="0" scrolling="no" loading="lazy" style="width:100%;" height="29">
</iframe>
</p>
<p data-sourcepos="237:1-237:212">上記をユーザのプロジェクトフォルダにクローン (<code>git clone</code>) して、<code>cd rust_interop_lib; cargo build --release</code> すれば、<code>target\release\rust_interop_lib.dll</code> にdllが生成される。</p>
<p data-sourcepos="239:1-239:317">あとは、TiXL (v4) の場合は (ユーザプロジェクトフォルダの) <code>dependencies</code> 直下に（<code>PlaceNativeDllDependenciesHere.txt</code>というファイルがあるフォルダの直下に） dllを置いて、冒頭のスクリーンショット ↓ のように正しい結果が出れば成功となる。</p>
<p data-sourcepos="241:1-241:213"><strong>もし、入力のValueAとValueBを0以外にしているにも関わらず計算結果が表示されなかったり、<code>-&gt; 0</code> のように結果がおかしい場合はdll読み込みに失敗している</strong>。</p>
<p data-sourcepos="243:1-243:189">（読み込まれない場合は、<code>bin\Debug</code> を一度削除して再起動するなどして、再ビルドを促すと正しくdllがコピーされ、読み込みが成功する。）</p>
<p data-sourcepos="245:1-245:146"><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F44103%2Ff206e7a2-633c-4a63-9bb0-d969a3ff1102.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=8081ec066359b0c80bef35c20003e700" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F44103%2Ff206e7a2-633c-4a63-9bb0-d969a3ff1102.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=8081ec066359b0c80bef35c20003e700" alt="スクリーンショット (5).png""https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/44103/f206e7a2-633c-4a63-9bb0-d969a3ff1102.png" loading="lazy"></a></p>
<h2 data-sourcepos="247:1-247:42">
<span id="補足-tixl-v4-でのdll配置場所" class="fragment"></span><a href="#%E8%A3%9C%E8%B6%B3-tixl-v4-%E3%81%A7%E3%81%AEdll%E9%85%8D%E7%BD%AE%E5%A0%B4%E6%89%80"><i class="fa fa-link"></i></a>補足: TiXL (v4) でのdll配置場所</h2>
<div data-sourcepos="249:1-251:3" class="note warn">
<span class="fa fa-fw fa-exclamation-circle"></span><div>
<p data-sourcepos="250:1-250:234">【追記】dll配置場所について、記事公開当初誤った記載をしていたので、前項の内容も含めて正しい記載に直しました。以下内容についても、追記後の内容となっています。</p>
</div>
</div>
<p data-sourcepos="253:1-253:243">記事公開当初、誤った配置場所にdllを置いていたり、再ビルドしていなかったりしたため、一度置いたdllが消えてしまったり、読み込まれなかったりのトラブルに見舞われていた。</p>
<p data-sourcepos="255:1-255:444"><strong>再ビルドしなくても必ずdllを読み込ませるための回避策は一応あって</strong>、TiXL自体のインストールフォルダの <code>runtimes\win-x64\native</code> にdllを置くという方法がある。具体的には、<code>C:\TiXL\TiXL-v4.0.2\runtimes\win-x64\native</code> や <code>C:\Program Files\TiXL\TiXL 4.0.5.2\runtimes\win-x64\native</code>以下にdllを置けば、C#オペレータの再ビルドに関係なくdllが読み込まれる。</p>
<p data-sourcepos="257:1-257:541">これで一応解決なのだけれど、これだと先に説明した、TiXL (v4) からユーザのプロジェクトフォルダが分離された意味があまりなくなってしまうので、ユーザプロジェクトフォルダの dependenciesフォルダに基本的にはユーザのdllは置き、必要に応じて再ビルド（<code>bin\Debug</code>を消して再起動するなど）させるようにしてほしい。（dependencies以下に置いたdllは、再ビルド時にdllは必ず実行パスにコピーされる。）</p>
<h2 data-sourcepos="259:1-259:12">
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h2>
<p data-sourcepos="261:1-261:320">これで好きな（Rustなどの）dllを呼び出すことが可能になった。例えばRustのDeep Learningフレームワークである<a href="https://burn.dev/" rel="nofollow noopener" target="_blank">burn</a>なども使えるようになるし、Rust以外にもC/C++やPyPyなどのdllも読み込めるので、できることの幅がぐんと広がる。</p>
<p data-sourcepos="263:1-263:586">なお、dllを毎回作るのはちょっと面倒だなぁと思う人は、<a href="https://benjamin.kuperberg.fr/chataigne/en" rel="nofollow noopener" target="_blank">Chataigne</a> (※フランス語で栗の意味) などのOSC通信によっていろんなやり取りを可能にする方法をまず検討すると良いかもしれない。これだとTiXL (Tooll) と別のソフトをいくつか立ち上げて通信することにはなるものの、OSCを介在して手っ取り早くいろんなやり取り（例えばArduinoとやり取りしたり、センサーやDAWとやり取りしたり）が可能になる。</p>
<p data-sourcepos="265:1-265:479">個人的に、dllを呼び出すよりもC#で直接書いたほうがいいケースのほうが多いとは思うので、nugetなどを使って外部ライブラリとやり取りする方法なども調べていきたい。（基本的には通常のC#プロジェクトと同じ流れになるはず。 <strong>【追記】</strong> <code>.csproj</code> があるフォルダで、<code>dotnet add package NumSharp</code> などすれば普通に使えた。Visual Studioの補完もきちんと効く。）</p>
<section class="footnotes">
<ol>
<li id="fn-1">
<p data-sourcepos="267:7-267:640">Exampleなどの雛形を消したい場合には、マウスで全選択して消せば良いのだけれど、そのとき全てのノードがプレビューされようとして重いので、Output Viewの画面をなにか一つにPin留めをしておくとスムーズに消せる。（Pinについては、F12キーのFocus Modeに入ったときに勝手にPin留めされたりとハマりがちなポイントなので、覚えておくと良いと思う。） <a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F44103%2F623754a0-63a3-4b37-893e-1242ef457d60.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=c82719cab1c0597f1a8a82fe31d07acc" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F44103%2F623754a0-63a3-4b37-893e-1242ef457d60.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=c82719cab1c0597f1a8a82fe31d07acc" alt="スクリーンショット 2025-05-20 123847a.png""https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/44103/623754a0-63a3-4b37-893e-1242ef457d60.png" loading="lazy"></a> <a href="#fnref-1" class="">↩</a></p>
</li>
<li id="fn-2">
<p data-sourcepos="269:7-269:436">Guidが一意になっていない場合（他と重複がある場合）は、Visual StudioやTiXL (Tooll3) の起動時に警告やエラーが出る。このとき最悪の場合はTiXL (Tooll) 自体が起動できなくなってしまうので、特に TiXL (v4) では、<a href="#c%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E9%96%8B%E3%81%8F%E6%96%B9%E6%B3%95">本文中で解説した</a>、中間生成結果のdllを消して再ビルドを促すような処置が必要になる。 <a href="#fnref-2" class="">↩</a></p>
</li>
<li id="fn-b">
<p data-sourcepos="273:7-273:493">Tooll3でもVisual Studioを使いたい場合は、公式ドキュメントの <a href="https://github.com/tixl3d/tixl/wiki/help.Installation#installing-with-development-environment" rel="nofollow noopener" target="_blank">Installing with development environment</a> を参考にしてほしい。ただし、TiXL v4の公開によってWikiの内容が変更になる可能性があるので、リンク切れに注意。現時点で既にgit cloneのURLはTiXL v4を指してしまっていたりするので、読み替えが必要。 <a href="#fnref-b" class="">↩</a></p>
</li>
<li id="fn-c">
<p data-sourcepos="275:7-275:303">Tooll3の場合は、dllの配置先はインストールフォルダ直下だが、各オペレータに関する中間ファイルは明示的には生成されないようなので、自作オペレータの再ビルドをかけたい場合は、単にTooll3を再起動すれば良いはず。 <a href="#fnref-c" class="">↩</a></p>
</li>
<li id="fn-a">
<p data-sourcepos="271:7-271:786">なぜ消えてしまうかについては、実はプロジェクトフォルダのLib以下に、元々のModuloのnamespaceと対応するフォルダ名の中に<code>.cs</code>/<code>.t3</code>/<code>.t3ui</code>が生成されている場合があり、<strong>namespaceをシステム側が何らかの要因で誤認するため</strong>だと思われる。これら3つのファイルに関して、フォルダを正しく移動させ直せば、直せると思われるが、現時点では未検証というか、個々の事象に対応できないので、このバグに見舞われた場合は、今後のリリースでの修正を待つか、個々人で丁寧にファイルを確認・移動・修正する必要がある。（筆者の場合は面倒なので別名で作り直したりしている。） <a href="#fnref-a" class="">↩</a></p>
</li>
</ol>
</section>
